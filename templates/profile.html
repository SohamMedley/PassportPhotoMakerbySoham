{% extends 'base.html' %}

{% block title %}Your Profile - PassportPro{% endblock %}

{% block content %}
<section class="profile-section">
    <div class="container">
        <div class="profile-header">
            <h2>Your Profile</h2>
            <p>Manage your account and saved passport photos</p>
        </div>
        
        <div class="profile-container">
            <div class="profile-sidebar">
                <div class="user-info">
                    <div class="user-avatar">
                        <span>{{ user.name[0] }}</span>
                    </div>
                    <div class="user-details">
                        <h3>{{ user.name }}</h3>
                        <p>{{ user.email }}</p>
                    </div>
                </div>
                
                <div class="profile-nav">
                    <ul>
                        <li class="active"><a href="#photos">My Photos</a></li>
                        <li><a href="#account">Account Settings</a></li>
                        <li><a href="/logout">Logout</a></li>
                    </ul>
                </div>
                
                <div class="usage-info">
                    <h4>Usage</h4>
                    <div class="usage-bar">
                        <div class="usage-progress" style="width: {{ (user.photos|length / 5) * 100 }}%"></div>
                    </div>
                    <p>{{ user.photos|length }} of 5 free photos used</p>
                    <a href="#upgrade" class="btn btn-outline btn-sm">Upgrade for more</a>
                </div>
            </div>
            
            <div class="profile-content">
                <div id="photos" class="profile-section-content active">
                    <div class="section-title">
                        <h3>My Passport Photos</h3>
                        <a href="/" class="btn btn-primary btn-sm">Create New Photo</a>
                    </div>
                    
                    {% if user.photos %}
                    <div class="photos-grid">
                        {% for photo in user.photos %}
                        <div class="photo-card">
                            <div class="photo-preview">
                                <img src="{{ photo.url }}" alt="Passport Photo">
                            </div>
                            <div class="photo-info">
                                <p>Created: {{ photo.created_at }}</p>
                                <div class="photo-actions">
                                    <a href="{{ photo.url }}" download class="btn btn-sm">Download</a>
                                    <button class="btn btn-sm btn-outline" data-photo-id="{{ photo.id }}">Delete</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <h4>No Photos Yet</h4>
                        <p>You haven't created any passport photos yet.</p>
                        <a href="/" class="btn btn-primary">Create Your First Photo</a>
                    </div>
                    {% endif %}
                </div>
                
                <div id="account" class="profile-section-content">
                    <div class="section-title">
                        <h3>Account Settings</h3>
                    </div>
                    
                    <form class="account-form">
                        <div class="form-group">
                            <label for="profile-name">Full Name</label>
                            <input type="text" id="profile-name" name="name" value="{{ user.name }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="profile-email">Email Address</label>
                            <input type="email" id="profile-email" name="email" value="{{ user.email }}" required>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                    
                    <div class="danger-zone">
                        <h4>Danger Zone</h4>
                        <p>Once you delete your account, there is no going back. Please be certain.</p>
                        <button id="delete-account" class="btn btn-danger">Delete Account</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Profile navigation
        const navItems = document.querySelectorAll('.profile-nav li');
        const sectionContents = document.querySelectorAll('.profile-section-content');
        
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                if (e.target.getAttribute('href') === '/logout') {
                    return; // Let the logout link work normally
                }
                
                e.preventDefault();
                
                // Remove active class from all items
                navItems.forEach(i => i.classList.remove('active'));
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Show corresponding section
                const targetId = e.target.getAttribute('href').substring(1);
                sectionContents.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.add('active');
                    } else {
                        section.classList.remove('active');
                    }
                });
            });
        });
        
        // Delete photo confirmation
        const deleteButtons = document.querySelectorAll('.photo-actions .btn-outline');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const photoId = this.getAttribute('data-photo-id');
                
                if (confirm('Are you sure you want to delete this photo? This action cannot be undone.')) {
                    // In a real app, this would send a request to the server
                    alert(`Photo ${photoId} deleted successfully.`);
                    // Remove the photo card from the UI
                    this.closest('.photo-card').remove();
                }
            });
        });
        
        // Delete account confirmation
        const deleteAccountBtn = document.getElementById('delete-account');
        
        deleteAccountBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete your account? All your data will be permanently removed. This action cannot be undone.')) {
                if (confirm('Please confirm once more that you want to delete your account.')) {
                    // In a real app, this would send a request to the server
                    alert('Your account has been scheduled for deletion. You will be logged out now.');
                    window.location.href = '/logout';
                }
            }
        });
    });
</script>
{% endblock %}

